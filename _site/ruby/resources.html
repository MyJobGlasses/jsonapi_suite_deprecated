<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>JSONAPI Suite</title>
  <meta name="description" content="Collection of Ruby libraries for powering JSONAPI-compliant APIs.">

  <link rel="stylesheet" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/assets/main.css?ref=wh4t3v45">
  <link rel="alternate" type="application/rss+xml" title="JSONAPI Suite" href="/feed.xml">

  <!-- javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  
</head>


  <body>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="navbar navbar-inverse normal" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated" class="navbar-brand">JSONAPI Suite</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a class="nav-link" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/quickstart">Quickstart</a>
        </li>
        <li>
          <a class="nav-link" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/tutorial">Tutorial</a>
        </li>
        <li>
          <a class="nav-link" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/concepts">Concepts</a>
        </li>
        <li>
          <a class="nav-link" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby">Docs</a>
        </li>
        <li>
          <a class="nav-link" href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/js/home">Javascript Client</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li>
          <a href="https://github.com/jsonapi-suite/jsonapi_suite" class="button">Fork on Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

        <div class="container">
          <div class="ruby-toc col-md-3">
  <ul>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/installation">Installation</a></li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/resources">Understanding Resources</a></li>
    <li>Reads
      <ul>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/basic-reads">Basic Reads</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/sorting">Sorting</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/pagination">Pagination</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/filtering">Filtering</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/fieldsets">Fieldsets</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/statistics">Statistics</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/activerecord-associations">ActiveRecord Associations</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/nested">Querying Relationships</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/serializers">Serializers</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/default-behavior">Default Behavior</a></li>
      </ul>
    </li>
    <li>Writes
      <ul>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/basic-writes">Basic Writes</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/validations">Validations</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/strong-resources">Strong Resources</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/nested-writes">Nested Writes</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/side-effects">Side Effects</a></li>
      </ul>
    </li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores">Alternate Datastores</a>
      <ul>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/elasticsearch">ElasticSearch</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/http">HTTP Services</a></li>
        <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/adapters">Adapters</a></li>
      </ul>
    </li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/scoping-to-current-user">Scoping to Current User</a></li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/backwards-compatibility">Backwards Compatibility</a></li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/swagger">Swagger</a></li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/testing">Integration Testing</a></li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/error-handling">Error Handling</a></li>
  </ul>
</div>

<div class="col-md-8 col-md-offset-1">
  <h3 id="resources">Resources</h3>

  <blockquote>
    <p>“A <code class="highlighter-rouge">Model</code> is to the <code class="highlighter-rouge">Database</code> what a <code class="highlighter-rouge">Resource</code> is to the <code class="highlighter-rouge">API</code>”</p>
  </blockquote>

  <p>Resources might look magical at first, but they are actually just a
simple collection of a few common hooks.</p>

  <p>Consider a traditional Rails controller:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">index</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
  <span class="n">render</span> <span class="ss">json: </span><span class="n">posts</span>
<span class="k">end</span></code></pre></figure>

  <p>Imagine if we had to implement the <a href="http://jsonapi.org">JSONAPI specification</a> by hand, ensuring our endpoints supported sorting, pagination, filtering, etc. You’d start seeing something along these lines:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># No query has fired yet, this is a blank ActiveRecord scope</span>
<span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>

<span class="k">if</span> <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:filter</span><span class="p">].</span><span class="nf">try</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span>
  <span class="c1"># Alter the scope if we're filtering</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="n">posts</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">title: </span><span class="n">title</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># ... etc ...</span>

<span class="k">if</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:sort</span><span class="p">]</span>
  <span class="c1"># Alter the scope if we're sorting</span>
  <span class="n">sort_dir</span> <span class="o">=</span> <span class="ss">:asc</span>
  <span class="k">if</span> <span class="n">sort</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span>
    <span class="n">sort_dir</span> <span class="o">=</span> <span class="ss">:desc</span>
  <span class="k">end</span>
  <span class="n">sort_att</span> <span class="o">=</span> <span class="n">sort</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="n">posts</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="n">sort_att</span> <span class="o">=&gt;</span> <span class="n">sort_dir</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># ... etc ...</span>

<span class="n">render</span> <span class="ss">json: </span><span class="n">posts</span><span class="p">.</span><span class="nf">to_a</span> <span class="c1"># Finally!</span></code></pre></figure>

  <p>In other words…it’d be a gross mess, especially when dealing with
<a href="http://jsonapi.org/format/#fetching-includes">inclusion of related
resources</a> or swapping
datastores. But the basic pattern - starting with a scope and then
decorating it based on incoming parameters - is incredibly powerful.</p>

  <p>Instead of writing this code by hand every time, let’s move the
boilerplate into a library and leave developers with only the part they
care about - <strong>how to modify the scope</strong>:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">allow_filter</span> <span class="ss">:title</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="n">scope</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">title: </span><span class="n">value</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">att</span><span class="p">,</span> <span class="n">dir</span><span class="o">|</span>
  <span class="n">scope</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="n">att</span> <span class="o">=&gt;</span> <span class="n">dir</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

  <p>This code lives in a <code class="highlighter-rouge">Resource</code>. All we’re doing here is specifying <a href="http://ruby-doc.org/core-2.1.1/Proc.html">Procs</a> that modify the scope, leaving boilerplate to the underlying <code class="highlighter-rouge">jsonapi_suite</code> library.</p>

  <p>Of course, with <code class="highlighter-rouge">ActiveRecord</code>, you’d see the same logic repeated here over
and over again. Let’s supply defaults to DRY up this code and end
with:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Whitelist the filter</span>
<span class="n">allow_filter</span> <span class="ss">:title</span></code></pre></figure>

  <p>…but allow developers to override those defaults whenever they’d like:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">allow_filter</span> <span class="ss">:title</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="n">scope</span><span class="p">.</span><span class="nf">where</span><span class="p">([</span><span class="s2">"title LIKE ?"</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">%"</span><span class="p">])</span>
<span class="k">end</span>

<span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute</span><span class="p">,</span> <span class="n">direction</span><span class="o">|</span>
  <span class="c1"># ... your custom sort logic ...</span>
<span class="k">end</span></code></pre></figure>

  <p>The important thing is: <strong>you still have full control of the query</strong>.
This is why JSONAPI Suite can easily work with any datastore, from SQL
to MongoDB to HTTP requests. The “behind-the-scenes defaults” are stored
in an <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/adapters">Adapter</a>.
Supply blocks for one-off customizations, or package them up into an
<code class="highlighter-rouge">Adapter</code> once those customizations become commonplace.</p>

  <p>By default, JSONAPI Suite comes with an <code class="highlighter-rouge">ActiveRecordAdapter</code>.</p>

  <h4 id="scopes---a-generic-query-building-pattern">Scopes - a Generic Query-Building Pattern</h4>

  <p>If you look closely at the above examples, you can see our code breaks
down into three key parts:</p>

  <ul>
    <li><strong>Step 1</strong>: Start with a “base scope” - a default query object.</li>
    <li><strong>Step 2</strong>: Modify that scope based on incoming parameters.</li>
    <li><strong>Step 3</strong>: Actually fire the query.</li>
  </ul>

  <p>This pattern applies to any ORM or datastore. Let’s try it with an HTTP
client that accepts a hash of options. A generic Rails controller might
look something like:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">index</span>
  <span class="c1"># Step 1: Our "base scope"</span>
  <span class="n">scope</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="c1"># Step 2: Modify that scope based on the request</span>
  <span class="k">if</span> <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:filter</span><span class="p">].</span><span class="nf">try</span><span class="p">(</span><span class="ss">:[]</span><span class="p">,</span> <span class="ss">:title</span><span class="p">)</span>
    <span class="n">scope</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>

  <span class="c1"># Step 3: actually fire the request + build some models</span>
  <span class="c1"># Post here is a PORO (plain old ruby object)</span>
  <span class="n">hashes</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/posts'</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="n">hashes</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># render</span>
  <span class="n">render</span> <span class="ss">json: </span><span class="n">posts</span>
<span class="k">end</span></code></pre></figure>

  <p>So our JSONAPI Suite equivalent would be:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Step 1: Define the base scope in the controller</span>
<span class="k">def</span> <span class="nf">index</span>
  <span class="n">base_scope</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="c1"># Pass the base scope to the resource, which will</span>
  <span class="c1"># build + fire the query.</span>
  <span class="c1">#</span>
  <span class="c1"># Then, render the results.</span>
  <span class="n">render_jsonapi</span><span class="p">(</span><span class="n">base_scope</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/resources/post_resource.rb</span>
<span class="c1">#</span>
<span class="c1"># Step 2: Modify the scope in the Resource</span>
<span class="n">allow_filter</span> <span class="ss">:title</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="n">scope</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="k">end</span>

<span class="c1"># Step 3: Actually fire the query</span>
<span class="c1"># This method must return an array of Model instances</span>
<span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
  <span class="n">hashes</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/posts'</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
  <span class="n">hashes</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

  <p>Again, you can package this logic into an <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/adapters">Adapter</a> if you found yourself repeating the same logic
over and over. Adapters DRY-up Resources.</p>

  <p>This pattern applies to sorting, pagination, statistics and such as
well - view the <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/basic-reads">Reads</a> documentation
for more.</p>

  <h4 id="associations">Associations</h4>

  <p>In the prior section, we noted the 3 key parts of query building. For
associations, we need to answer 2 key questions:</p>

  <ul>
    <li><strong>Question 1</strong>: Given an array of parents, what should the “base scope” be
in order to query only relevant children?</li>
    <li><strong>Question 2</strong>: Once we’ve resolved both the parents and the children, how do
we associate these objects together?</li>
  </ul>

  <p>Let’s switch back to vanilla <code class="highlighter-rouge">ActiveRecord</code> for a second. We’ve resolved
the <code class="highlighter-rouge">Post</code>s and need to fetch the <code class="highlighter-rouge">Comment</code>s. Here’s how we’d answer
these questions:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">allow_sideload</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">resource: </span><span class="no">CommentResource</span> <span class="k">do</span>
  <span class="c1"># Question 1: What's a "base scope" that will return only</span>
  <span class="c1"># relevant comments?</span>
  <span class="n">scope</span> <span class="k">do</span> <span class="o">|</span><span class="n">posts</span><span class="o">|</span>
    <span class="no">Comment</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">post_id: </span><span class="n">posts</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:id</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="c1"># Question 2: How do we assign these objects together?</span>
  <span class="n">assign</span> <span class="k">do</span> <span class="o">|</span><span class="n">posts</span><span class="p">,</span> <span class="n">comments</span><span class="o">|</span>
    <span class="n">posts</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
      <span class="n">post</span><span class="p">.</span><span class="nf">comments</span> <span class="o">=</span> <span class="n">comments</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">post_id</span> <span class="o">==</span> <span class="n">post</span><span class="p">.</span><span class="nf">id</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

  <p>Just like in our prior sections, we can see the same logic would repeat
over and over again each time we added a new relationship…with some slight tweaks based on
<code class="highlighter-rouge">has_many/belongs_to</code>, non-standard foreign keys and such. So our
default <code class="highlighter-rouge">ActiveRecord</code> adapter comes with <strong>macros</strong> that generate this
lower-level code for us:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span>
  <span class="ss">resource: </span><span class="no">CommentResource</span><span class="p">,</span>
  <span class="ss">scope: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">all</span> <span class="p">},</span>
  <span class="ss">foreign_key: :post_id</span></code></pre></figure>

  <p>You can dig deeper into the various <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/reads/activerecord-associations">ActiveRecord Association Macros here</a>.</p>

  <p>Let’s go back to HTTP calls. Imagine the <code class="highlighter-rouge">CommentResource</code> worked just
like our HTTP-based <code class="highlighter-rouge">PostResource</code> from the prior section. Let’s see how
those same questions would be answered:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Step 1: What's a base scope that will return only</span>
<span class="c1"># relevant comments?</span>
<span class="c1">#</span>
<span class="c1"># In the case of our HTTP client, the "base scope" is</span>
<span class="c1"># nothing more than a ruby hash.</span>
<span class="c1">#</span>
<span class="c1"># Our final query would end up something like:</span>
<span class="c1">#</span>
<span class="c1"># HTTP.get('/comments', { post_id: [1,2,3] })</span>
<span class="n">scope</span> <span class="k">do</span> <span class="o">|</span><span class="n">posts</span><span class="o">|</span>
  <span class="p">{</span> <span class="ss">post_id: </span><span class="n">posts</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:id</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># Step 2: How do we assign these objects together?</span>
<span class="c1"># This code is unchanged from the prior example</span>
<span class="n">assign</span> <span class="k">do</span> <span class="o">|</span><span class="n">posts</span><span class="p">,</span> <span class="n">comments</span><span class="o">|</span>
  <span class="n">posts</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">comments</span> <span class="o">=</span> <span class="n">comments</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">post_id</span> <span class="o">==</span> <span class="n">post</span><span class="p">.</span><span class="nf">id</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

  <p>The key lessons here:</p>

  <ul>
    <li><code class="highlighter-rouge">scope</code> must return a “base scope” that can be further modified.
This way we can apply additional “deep query” logic - maybe we
want to sort these comments - and re-use the query-building code
defined in <code class="highlighter-rouge">CommentResource</code>. This allows the same logic at the
<code class="highlighter-rouge">/comments</code> endpoint to apply to the <code class="highlighter-rouge">/posts?include=comments</code>
endpoint.</li>
    <li>If you’re not sure what the scope should be, look into the relevant
<code class="highlighter-rouge">Resource</code>, particularly the <a href="https://jsonapi-suite.github.io/jsonapi_compliable/JsonapiCompliable/Resource.html#resolve-instance_method">#resolve</a> method,
to see how the query will actually be executed. If there is no
#resolve method, it’s using the default of the relevant <code class="highlighter-rouge">Adapter</code>.
      <ul>
        <li>Typically, you’d define an <code class="highlighter-rouge">ApplicationRecord</code> who specifies the
  <code class="highlighter-rouge">Adapter</code>. You’ll see this pattern if you use our generators.</li>
      </ul>
    </li>
    <li><a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/alternate-datastores/adapters">Adapters</a> can
DRY-up this logic with <code class="highlighter-rouge">has_many</code>-style macros.</li>
  </ul>

  <h4 id="writes">Writes</h4>

  <p>In the prior sections, we removed boilerplate and dropped down to only
the important code of scope modification. The same basic premise applies to write operations as well. Rather than
dealing with parsing the incoming payload and associating the graph of
objects, Suite supplies hooks for just the parts you care about:
<strong>actually persisting objects</strong>.</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
  <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
  <span class="n">post</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">post</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
  <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:id</span><span class="p">))</span>
  <span class="n">post</span><span class="p">.</span><span class="nf">update_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
  <span class="n">post</span>
<span class="k">end</span>

<span class="c1"># ... etc ...</span></code></pre></figure>

  <p>Just like reads, this logic is usually extracted into an <code class="highlighter-rouge">Adapter</code>, but
you can always use <code class="highlighter-rouge">super</code> to override, handle side effects, etc.</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
  <span class="n">model</span> <span class="o">=</span> <span class="k">super</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"</span><span class="si">#{</span><span class="n">model</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2"> created with id </span><span class="si">#{</span><span class="n">model</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">!"</span>
  <span class="n">model</span>
<span class="k">end</span></code></pre></figure>

  <p>See the <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/ruby/writes/basic-writes">Writes</a> section for
more.</p>

  <h4 id="generators">Generators</h4>

  <p>If you’re unsure of how a “default project” should look, use the
<code class="highlighter-rouge">bin/rails g jsonapi:resource</code> generator:</p>

  <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="n">jsonapi</span><span class="ss">:resource</span> <span class="no">Post</span> <span class="n">title</span><span class="ss">:string</span>
</code></pre>
  </div>

  <p>This generator can also limit the controller actions:</p>

  <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="n">jsonapi</span><span class="ss">:resource</span> <span class="no">Post</span> <span class="n">title</span><span class="ss">:string</span> <span class="o">-</span><span class="n">a</span> <span class="n">index</span>
</code></pre>
  </div>

  <p>It’s <strong>highly encouraged</strong> you run these generators at least once, as
you’ll get a bunch of helpful comments and understand baseline
scenarios. You’re getting:</p>

  <ul>
    <li>A controller (e.g. <code class="highlighter-rouge">PostsController</code>)</li>
    <li>A route (<code class="highlighter-rouge">/&lt;api_namespace&gt;/v1/posts</code>)</li>
    <li>A <code class="highlighter-rouge">Resource</code> (<code class="highlighter-rouge">PostResource</code>)</li>
    <li>Integration spec boilerplate
      <ul>
        <li>including Factories</li>
        <li>…and <code class="highlighter-rouge">Payload</code>s</li>
      </ul>
    </li>
    <li>A whitelist of incoming parameters for writes
  (<code class="highlighter-rouge">config/initializer/strong_resource.rb</code>)</li>
  </ul>

  <p>Type <code class="highlighter-rouge">bin/rails g jsonapi:resource --help for details</code>.</p>

  <h4 id="wrapping-up">Wrapping Up</h4>

  <p>There’s more to learn about various ways <code class="highlighter-rouge">Resource</code>s can be customized,
but that’s the basic premise: no magic, just removal of boilerplate.</p>

  <blockquote>
    <p>Note: the same <code class="highlighter-rouge">Resource</code> logic can be re-used across endpoints, to
support logic like “fetch this <code class="highlighter-rouge">Post</code> and its <code class="highlighter-rouge">Comment</code>s that are
<code class="highlighter-rouge">active</code>”. Whether you’re sideloading comments from the <code class="highlighter-rouge">/posts</code>
endpoint or accessing the <code class="highlighter-rouge">/comments</code> endpoint directly, the same
<code class="highlighter-rouge">Resource</code> logic applies.</p>
  </blockquote>

  <blockquote>
    <p>See the <a href="https://jsonapi-suite.github.io/jsonapi_compliable/JsonapiCompliable/Resource.html">Resource</a> documentation for more.</p>
  </blockquote>
</div>

        </div>
      </div>
    </main>
    <div class="main-footer main-footer--dark">
  <div class="container">
    <div class="row">
      <div class="col-sm-4 menu">
        <h3>Overview</h3>
        <ul>
          <li>
            <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/quickstart">Quickstart</a>
          </li>
          <li>
            <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/tutorial">Tutorial</a>
          </li>
          <li>
            <a href="https://jsonapi-suite.github.io/jsonapi_suite_deprecated/concepts">Concepts</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Resources</h3>
        <ul>
          <li>
            <a target="_blank" href="https://jsonapi-suite.github.io/jsonapi_compliable">YARD Documentation</a>
          </li>
          <li>
            <a target="_blank" href="https://join.slack.com/t/jsonapi-suite/shared_invite/enQtMjkyMTA3MDgxNTQzLWVkMDM3NTlmNTIwODY2YWFkMGNiNzUzZGMzOTY3YmNmZjBhYzIyZWZlZTk4YmI1YTI0Y2M0OTZmZGYwN2QxZjg">Slack Chat</a>
          </li>
          <li>
            <a href="mailto:richmolj@gmail.com">Contact us</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Related</h3>
        <ul>
          <li>
            <a target="_blank" href="http://jsonapi.org">JSONAPI Spec</a>
          </li>
          <li>
            <a target="_blank" href="http://jsonapi-rb.org">jsonapi-rb</a>
          </li>
          <li>
            <a target="_blank" href="https://vuejs.org/">VueJS</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <script type="text/javascript">
$(function () {

  var flipTabs = function() {
    var isTS = true;
    if (localStorage.getItem('js-lang') === 'javascript') {
      isTS = false;
    }

    $('.code-tabs').each(function(index, el) {
      if (isTS) {
        console.log('hiding js');
        $($(el).children()[1]).hide();
        $($(el).children()[0]).show();
      } else {
        console.log('hiding ts');
        $($(el).children()[0]).hide();
        $($(el).children()[1]).show();
      }
    });

    if (isTS) {
      $('.tab.typescript').addClass('active');
      $('.tab.javascript').removeClass('active');
    } else {
      $('.tab.typescript').removeClass('active');
      $('.tab.javascript').addClass('active');
    }
  }

  $('.tab').click(function() {
    if ($(this).hasClass('typescript')) {
      localStorage.setItem('js-lang', 'typescript');
    } else {
      localStorage.setItem('js-lang', 'javascript');
    }

    flipTabs();
  });

  flipTabs();
})
</script>

  </body>
</html>
